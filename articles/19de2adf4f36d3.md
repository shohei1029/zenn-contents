---
title: "OpenAI Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’Azure API Managementã¨å…±ã«ä½¿ã†ãƒ¡ãƒ¢"
emoji: "ğŸ“–"
type: "tech"
topics:
  - "azure"
  - "azureapimanagement"
  - "openai"
  - "chatgpt"
  - "azureopenai"
published: true
published_at: "2023-08-25 18:56"
publication_name: "microsoft"
---

# ã¯ã˜ã‚ã«
[OpenAI Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒª](https://github.com/openai/openai-python)ã¯Pythonã‹ã‚‰OpenAI APIã‚„Azure OpenAI Serviceã®ãƒ¢ãƒ‡ãƒ«ã‚’åˆ©ç”¨ã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ç›´æ¥Azure OpenAIã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ç°¡å˜ã ã£ãŸã®ã§ã™ãŒã€é–“ã«Azure API Management (APIM)ã‚’æŒŸã‚“ã å ´åˆã«ä¸€éƒ¨è¨­å®šã‚’è¡Œã†å¿…è¦ãŒã‚ã£ãŸãŸã‚ã€ãƒ¡ãƒ¢ã—ã¾ã™ã€‚

# å‰æ
[openai-python-enterprise-logging](https://github.com/Azure-Samples/openai-python-enterprise-logging#api-management-config)ã®ã‚µãƒ³ãƒ—ãƒ«ãªã©ã‚’å‚è€ƒã«ã—ã€APIMã®ãƒªã‚½ãƒ¼ã‚¹ã‚„Azure OpenAIã¨ã®æ¥ç¶šè¨­å®šã¯æ¸ˆã‚“ã§ã„ã‚‹å‰æã«ã—ã¾ã™ã€‚

# è¨­å®šç®‡æ‰€
3ã¤ã‚ã‚Šã¾ã™ã€‚

## HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®å¤‰æ›´ [APIM]
HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ãŒã€OpenAIç¤¾APIã‚„Azure OpenAIã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãŒ`api-key`ãªã®ã«å¯¾ã—ã€APIMã¯`Ocp-Apim-Subscription-Key`ã«ãªã£ã¦ã—ã¾ã†ãŸã‚ã€è¨­å®šå¤‰æ›´ãŒå¿…è¦ã§ã™ã€‚
**æ‰‹é †**
1. APIMã®Portalç”»é¢ã§ã€ä¸‹å›³ã®æ‰‹é †ã§ã€ŒAdd policyã€ã‚’é¸æŠã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/09028b550580-20230825.png)

2. ãƒãƒªã‚·ãƒ¼ã®ä¸€è¦§ã‹ã‚‰ã€ã€ŒSet headersã€ã‚’é¸æŠã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/432b485129a7-20230825.png)

3. åå‰ (NAME)ã‚’`api-key`ã«å¤‰æ›´ã—ã€Azure OpenAIã®APIã‚­ãƒ¼ã‚’VALUEã«è¨˜è¼‰ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/454da21f03cf-20230825.png)

## API URL suffixã®å¤‰æ›´ [APIM]
ã€ŒSettingsã€ã‚¿ãƒ–ã®API URL suffixé …ç›®ã«`openai`ã¨è¨˜è¼‰ã—ã¾ã™ã€‚
ä»–ã®æ–‡å­—åˆ—ã‚’å…¥ã‚Œã‚‹å ´åˆã‚‚ã€å¿…ãšBase URLã®æœ«å°¾ã¯`/openai`ã§çµ‚ã‚ã‚‹ã‚ˆã†ã«ã—ã¾ã™ (ä¾‹ï¼š`https://apim-openai-shohei.azure-api.net/gund-arm/hogehoge/openai`)

![](https://storage.googleapis.com/zenn-user-upload/ef22e4c2aaae-20230825.png)

## `api_key`ã¨`api_base`ã®å¤‰æ›´ [OpenAI ãƒ©ã‚¤ãƒ–ãƒ©ãƒª]
OpenAI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®`api_key`ã¨`api_base`ã‚’APIMã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã¨ã€ä¸Šè¨˜ã§è¨­å®šã—ãŸBase URLã«å¤‰æ›´ã—ã¾ã™ã€‚

```Python
import openai

openai.api_type = "azure"
openai.api_key = "<YOUR API MANAGEMENT KEY>"
openai.api_base = "https://apim-openai-shohei.azure-api.net/"
openai.api_version = "2023-05-15"
```

OpenAI Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã€å†…éƒ¨çš„ã«`api_base`ã®æœ«å°¾ã«`/openai/deployments/gpt-35-turbo/chat/completions?api-version=2023-05-15`ã®ã‚ˆã†ãªæ–‡å­—åˆ—ã‚’ã¤ã‘ã¦URLã‚’å®Œæˆã•ã›ã€Azure OpenAIãƒ¢ãƒ‡ãƒ«ã‚’å‘¼ã³å‡ºã™å½¢ã«ãªã‚Šã¾ã™ã€‚ãã®ãŸã‚APIMå´ã§API URL suffixã®æœ«å°¾ã«`openai`ã¨ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

# ãŠã‚ã‚Šã«
ã©ã“ã‹ã«æƒ…å ±ãŒè¼‰ã£ã¦ã„ã‚‹ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€API URL suffixã®æœ«å°¾ã«`openai`ã¨ã¤ã‘ã‚‹æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‰ãšã€APIMçµŒç”±ã§ã®å‘¼ã³å‡ºã—ã«æ‰‹é–“å–ã‚Šã¾ã—ãŸã€‚çš†æ§˜ãŒåŒã˜è‹¦åŠ´ã‚’æ­©ã¾ãªã„ã‚ˆã†ã«ã“ã“ã«æ®‹ã—ã¾ã™ã€‚

